{% extends 'orders/base.html' %}
{% load humanize %}

{% block title %}Delivery Orders | Payment Tracker{% endblock %}

{% block content %}
<div class="content content-fixed bd-b">
  <div class="container pd-x-0 pd-lg-x-10 pd-xl-x-0">
    <div class="d-sm-flex align-items-center justify-content-between">
      <div>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb breadcrumb-style1 mg-b-10">
            <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
            <li class="breadcrumb-item active" aria-current="page">Delivery Orders</li>
          </ol>
        </nav>
        <h4 class="mg-b-0">All Closed Delivery Orders</h4>
      </div>
    </div>
  </div><!-- container -->
</div><!-- content -->

<div class="content">
  <div class="container pd-x-0 pd-lg-x-10 pd-xl-x-0">
    <div class="row">
      <div class="col-md-9 col-sm-12">
        <div class="card mg-b-20 mg-t-10" id="orders-table-card">
          <div class="card-header pd-t-16 d-sm-flex align-items-start justify-content-between bd-b-0 pd-b-0">
            <div>
              <h6 class="mg-b-3 pb-0">Closed Delivery Orders</h6>
              <p class="tx-13 tx-color-03 mg-b-20">Closed or settled delivery orders.</p>
            </div>
            <div class="d-flex mg-t-20 mg-sm-t-0">
              <form>
                <div class="search-form mg-l-15 d-none d-sm-flex justify-content-end">
                  <input type="search" name="search" class="form-control" placeholder="Search" value="{{ search_query }}">
                  <button class="btn" type="submit"><i data-feather="search"></i></button>
                </div>
              </form>
            </div>
          </div><!-- card-header -->
          <div class="table-responsive">
            <table class="table table-dashboard mg-b-0" id="closed-delivery-order-table">
              <thead>
                <tr>
                  <th>Closed Date</th>
                  <th>Vessel</th>
                  <th>Letter of Credit</th>
                  <th>Batch</th>
                  <th>Product</th>
                  <th class="text-right">Status</th>
                </tr>
              </thead>
              <tbody>
                {% for order in object_list %}
                <tr>
                  <td class="tx-color-03 tx-normal">{{ order.updated_at|date:'d/m/Y' }}</td>
                  <td class="tz-color-03 tx-medium">
                    <a href="{% url 'orders:order-detail' order.pk %}">{{ order.vessel }}</a>
                  </td>
                  <td class="tz-color-03 tx-normal">{{ order.lc_number }}</td>
                  <td class="tz-color-03 tx-normal">{{ order.batch.name }}</td>
                  <td class="tz-color-03 tx-normal">{{ order.batch.product.name }}</td>
                  <td class="text-right"><span class="badge badge-secondary">closed</span></td>
                </tr>
                {% empty %}
                <tr class="empty-row">
                  {% if search_query %}
                  <td colspan="8" class="tx-medium tx-color-03 text-center pt-5 pb-5 tx-24">No Result Found</td>
                  {% else %}
                  <td colspan="8" class="tx-medium tx-color-03 text-center pt-5 pb-5 tx-24">No Closed Delivery Order</td>
                  {% endif %}
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div><!-- table-responsive -->
        </div><!-- card -->

        <!-- Pagination -->
        <nav aria-label="Page navigation example" id="pagination-nav">
          {% if is_paginated %}
          <ul class="pagination pagination-circle justify-content-end mg-b-0">
            {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link page-link-icon" href="?page={{ page_obj.previous_page_number }}">
                <i class="fas fa-chevron-left"></i>
              </a>
            </li>
            {% else %}
            <li class="page-item disabled">
              <a class="page-link page-link-icon" href="#">
                <i class="fas fa-chevron-left"></i>
              </a>
            </li>
            {% endif %}

            {% for i in paginator.page_range %}
            {% if page_obj.number == i %}
            <li class="page-item active"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
            {% else %}
            <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
            {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link page-link-icon" href="?page={{ page_obj.next_page_number }}"><i
                  class="fas fa-chevron-right"></i></a>
            </li>
            {% else %}
            <li class="page-item disabled">
              <a class="page-link page-link-icon" href="#">
                <i class="fas fa-chevron-right"></i>
              </a>
            </li>
            {% endif %}
          </ul>
          {% endif %}
        </nav>
      </div><!-- col -->

      <!-- Aside Filter Links -->
      {% include 'orders/partials/links_aside.html' %}
    </div><!-- row -->
  </div><!-- container -->
</div><!-- content -->

<script>
  $(function() {
    $('input[name=search]').on('keyup change', function() {
      var query = $(this).val();
      var url = '{{ request.path }}?search=' + query;

      $.get(url, function(data) {
        var $table = $('#closed-delivery-order-table');
        var $pagination = $('#pagination-nav');

        $table.replaceWith($(data).find('#closed-delivery-order-table'));
        $pagination.replaceWith($(data).find('#pagination-nav'));
      });
    });
  });
</script>
{% endblock %}
