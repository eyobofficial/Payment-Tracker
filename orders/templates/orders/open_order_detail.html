{% extends 'orders/base.html' %}
{% load humanize %}
{% load shared_tags %}

{% block title %}Delivery Orders | Payment Tracker{% endblock %}

{% block content %}
<div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-25 mg-xl-b-30">
  <div>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb breadcrumb-style1 mg-b-10">
        <li class="breadcrumb-item"><a href="#">Dashbooard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'orders:open-orders-list' %}">Open Delivery Orders</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ object.lc_number }} </li>
      </ol>
    </nav>
    <h4 class="mg-b-0 tx-spacing--1">Delivery Order for {{ object.vessel }} Vessel</h4>
  </div>
  <div class="d-none d-md-block">
    <button class="btn btn-sm pd-x-15 btn-white btn-uppercase btn-modal" data-url="{% url 'orders:order-close' object.pk %}">
      <i data-feather="flag" class="wd-10 mg-r-5"></i> Close
    </button>
    <button class="btn btn-sm pd-x-15 btn-white btn-uppercase mg-l-5"><i data-feather="file-text" class="wd-10 mg-r-5"></i>
      Letter</button>
    <button class="btn btn-sm pd-x-15 btn-primary btn-uppercase mg-l-5 btn-modal"
      data-url="{% url 'orders:open-order-update' object.pk %}">
      <i data-feather="edit" class="wd-10 mg-r-5"></i> Edit
    </button>
  </div>
</div>

<div class="row row-xs">
  <div class="col-sm-6 col-lg-3">
    <div class="card card-body">
      <h6 class="tx-uppercase tx-11 tx-spacing-1 tx-color-02 tx-semibold mg-b-8">Opened Date</h6>
      <div class="d-flex d-lg-block d-xl-flex align-items-end">
        <h3 class="tx-normal tx-rubik mg-b-0 mg-r-5 lh-1">{{ object.created_at|date:'d/m/Y' }}</h3>
      </div>
    </div>
  </div><!-- col -->
  <div class="col-sm-6 col-lg-3 mg-t-10 mg-sm-t-0">
    <div class="card card-body">
      <h6 class="tx-uppercase tx-11 tx-spacing-1 tx-color-02 tx-semibold mg-b-8">Status</h6>
      <div class="d-flex d-lg-block d-xl-flex align-items-end">
        <h3 class="tx-normal tx-rubik text-success mg-b-0 mg-r-5 lh-1">{{ object.get_status_display|upper }}</h3>
      </div>
    </div>
  </div><!-- col -->
  <div class="col-sm-6 col-lg-3 mg-t-10 mg-lg-t-0">
    <div class="card card-body">
      <h6 class="tx-uppercase tx-11 tx-spacing-1 tx-color-02 tx-semibold mg-b-8">Order Rate</h6>
      <div class="d-flex d-lg-block d-xl-flex align-items-end">
        <h3 class="tx-normal tx-rubik mg-b-0 mg-r-5 lh-1">${{ object.rate|intcomma }}</h3>
      </div>
    </div>
  </div><!-- col -->
  <div class="col-sm-6 col-lg-3 mg-t-10 mg-lg-t-0">
    <div class="card card-body">
      <h6 class="tx-uppercase tx-11 tx-spacing-1 tx-color-02 tx-semibold mg-b-8">Order Quantity</h6>
      <div class="d-flex d-lg-block d-xl-flex align-items-end">
        {% if not object.get_total_quantity %}
        <h3 class="tx-normal tx-rubik mg-b-0 mg-r-5 lh-1">-</h3>
        {% else %}
        <h3 class="tx-normal tx-rubik mg-b-0 mg-r-5 lh-1">{{ object.get_total_quantity|intcomma}} MT</h3>
        {% endif %}
      </div>
    </div>
  </div><!-- col -->
</div>

<div class="row row-xs row-flex">
  <div class="col-sm-3 col-lg-3 mg-t-20">
    <div class="card ht-100p">
      <div class="card-header d-flex justify-content-between">
        <h6 class="lh-5 mg-b-0">Delivery Order Summary</h6>
      </div><!-- card-header -->
      <div class="card-body pd-x-20">
        <ul class="list-group list-group-flush mg-b-0 tx-13">
          <li class="list-group-item pd-x-0 d-flex justify-content-between">
            <span class="tx-normal">L/C Number</span>
            <span class="tx-medium">{{ object.lc_number }}</span>
          </li>
          <li class="list-group-item pd-x-0 d-flex justify-content-between">
            <span class="tx-normal">Vessel</span>
            <span class="tx-medium">{{ object.vessel }}</span>
          </li>
          <li class="list-group-item pd-x-0 d-flex justify-content-between">
            <span class="tx-normal">Supplier</span>
            <span class="tx-medium">{{ object.supplier.name }}</span>
          </li>
          <li class="list-group-item pd-x-0 d-flex justify-content-between">
            <span class="tx-normal">Product</span>
            <span class="tx-medium">{{ object.product.name }}</span>
          </li>
          <li class="list-group-item pd-x-0 d-flex justify-content-between">
            <span class="tx-normal">Created by</span>
            <span class="tx-medium">{{ object.created_by.get_full_name }}</span>
          </li>
          <li class="list-group-item pd-x-0 d-flex justify-content-between">
            <span class="tx-normal">Last Updated</span>
            <span class="tx-medium">{{ object.updated_at|date:'d/m/Y' }}</span>
          </li>
        </ul>
      </div><!-- card-body -->
    </div><!-- card -->
  </div><!-- col -->

  <div class="col-sm-9 mg-t-20">
    <div class="card mg-b-10 ht-100p">
      <div class="card-header pd-t-16 d-sm-flex align-items-start justify-content-between bd-b-0 pd-b-0">
        <div>
          <h6 class="mg-b-3">Delivery Allocations</h6>
          <p class="tx-13 tx-color-03 mg-b-10">Region allocations as per the agreement</p>
        </div>
        <div class="d-flex mg-t-20 mg-sm-t-0">
          <div class="btn-group flex-fill">
            {% if not object.is_fully_allocated %}
            <button class="btn btn-white btn-xs btn-modal" data-url="{% url 'orders:order-allocation-create' object.pk %}">
              <i data-feather="plus" class="wd-10 mg-r-5"></i> Add Allocation
            </button>
            {% endif %}
          </div>
        </div>
      </div><!-- card-header -->

      <div class="card-body pd-x-0">
        {% if object.get_total_quantity %}
        <div class="d-sm-flex justify-content-between pd-b-30 pd-x-20">
          <div class="media">
            <div
              class="wd-40 wd-md-50 ht-40 ht-md-50 bg-primary tx-white mg-r-10 mg-md-r-10 d-flex align-items-center justify-content-center rounded op-6">
              <i data-feather="bar-chart-2"></i>
            </div>
            <div class="media-body">
              <h6 class="tx-sans tx-uppercase tx-10 tx-spacing-1 tx-color-03 tx-semibold tx-nowrap mg-b-5 mg-md-b-8">Total Quantity</h6>
              <h4 class="tx-20 tx-sm-18 tx-md-24 tx-normal tx-rubik mg-b-0">{{ object.get_total_quantity|intcomma }} MT</h4>
            </div>
          </div>
          <div class="media mg-t-20 mg-sm-t-0 mg-sm-l-15 mg-md-l-40">
            <div
              class="wd-40 wd-md-50 ht-40 ht-md-50 bg-teal tx-white mg-r-10 mg-md-r-10 d-flex align-items-center justify-content-center rounded op-5">
              <i data-feather="dollar-sign"></i>
            </div>
            <div class="media-body">
              <h6 class="tx-sans tx-uppercase tx-10 tx-spacing-1 tx-color-03 tx-semibold mg-b-5 mg-md-b-8">Total Amount</h6>
              <h4 class="tx-20 tx-sm-18 tx-md-24 tx-normal tx-rubik mg-b-0">${{ object.get_total_amount|whole_part|intcomma }}<small>.{{ object.get_total_amount|decimal_part }}</small></h4>
            </div>
          </div>
          <div class="media mg-t-20 mg-sm-t-0 mg-sm-l-15 mg-md-l-40">
            <div
              class="wd-40 wd-md-50 ht-40 ht-md-50 bg-pink tx-white mg-r-10 mg-md-r-10 d-flex align-items-center justify-content-center rounded op-4">
              <i data-feather="percent"></i>
            </div>
            <div class="media-body">
              <h6 class="tx-sans tx-uppercase tx-10 tx-spacing-1 tx-color-03 tx-semibold mg-b-5 mg-md-b-8">Total 10% Amount</h6>
              <h4 class="tx-20 tx-sm-18 tx-md-24 tx-normal tx-rubik mg-b-0">${{ object.get_total_retention|whole_part|intcomma }}<small>.{{ object.get_total_retention|decimal_part }}</small></h4>
            </div>
          </div>
        </div>
        {% endif %}
        <div class="table-responsive">
          <table class="table table-dashboard table-card mg-b-0">
            <thead>
              <tr>
                <th>Region</th>
                <th class="text-right">Quantity (MT)</th>
                <th class="text-right">Rate (USD)</th>
                <th class="text-right">Total Amount (USD)</th>
                <th class="text-right">10% of Total (USD)</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for allocation in object.order_allocations.all %}
              <tr>
                <td class="tz-color-03 tx-normal">{{ allocation.buyer.region }}</td>
                <td class="tz-color-03 tx-normal text-right">{{ allocation.quantity|intcomma }}</td>
                <td class="tz-color-03 tx-normal text-right">{{ object.rate|intcomma }}</td>
                <td class="text-right tx-normal text-right">{{ allocation.get_amount|intcomma }}</td>
                <td class="tx-teal tx-medium text-right">{{ allocation.get_retention|intcomma }}</td>
                <td class="text-right">
                  <div class="mg-l-auto d-flex justify-content-end">
                    <nav class="nav nav-icon-only">
                      <a data-url="{% url 'orders:open-allocation-update' allocation.pk %}" class="nav-link d-none d-sm-block btn-modal" title="Edit"><i data-feather="edit-3"></i></a>
                      <a data-url="{% url 'orders:allocation-delete' allocation.pk %}" class="nav-link d-none d-sm-block btn-modal" title="Delete">
                        <i data-feather="trash"></i>
                      </a>
                    </nav>
                  </div>
                </td>
              </tr>
              {% empty %}
              <tr class="empty-row">
                <td colspan="5" class="tx-medium tx-color-03 text-center pt-5 pb-5 h5">No Allocation</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div><!-- table-responsive -->
      </div>
    </div><!-- card -->
  </div><!-- col -->
</div><!-- row -->
{% endblock %}
